# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
PortGroup           net.macports 1.0

github.setup        macports macports-infrastructure 67c1289489e25a6ebca71b6547efee2dc5f70195
checksums           rmd160  f789873f6ee57483f29d18e6dde6c55452ad3c19 \
                    sha256  fc87c7c03c0adca6dcbcc255f14eda39a7fc6e0786f967a294a503c03543b17a \
                    size    45638

name                net.macports.mprsyncup
version             27
revision            0

github.tarball_from archive
dist_subdir         ${github.project}

set python_branch   3.13
set python_version  [string map {. {}} ${python_branch}]

depends_run         port:coreutils \
                    port:git \
                    port:gzip \
                    port:moreutils \
                    port:python${python_version} \
                    port:rsync

worksrcdir          ${worksrcdir}/jobs

extract.post_args-append \
                    ${worksrcdir}

patchfiles          delete_old_archives.py.patch \
                    mprsyncup.patch

destroot.keepdirs   ${destroot}${prefix}/var/log/${name} ${destroot}/Volumes/RAID${prefix}/var/rsync/macports
destroot {
    xinstall -d -o buildbot -g buildbot ${destroot}${prefix}/var/log/${name} ${destroot}/Volumes/RAID${prefix}/var/rsync/macports
    xinstall -W ${worksrcpath} current_versions.tcl delete_old_archives.py mprsyncup ${destroot}${prefix}/bin
    xinstall -W ${filespath} current_versions_for_each_portindex.sh mprsyncup-ts ${destroot}${prefix}/bin
    xinstall -m 0644 ${filespath}/${name}.plist.in ${destroot}/Library/${startupitem.location}/${name}.plist
    reinplace -W ${destroot}${prefix}/bin "s|@PREFIX@|${prefix}|g" current_versions_for_each_portindex.sh mprsyncup mprsyncup-ts ${destroot}/Library/${startupitem.location}/${name}.plist
    reinplace -W ${destroot}${prefix}/bin "1s|^#!/usr/bin/env |#!${prefix}/bin/|" current_versions.tcl
    reinplace -W ${destroot}${prefix}/bin "1s|^#!/usr/bin/env python$|#!${prefix}/bin/python${python_branch}|" delete_old_archives.py
}
