# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
PortGroup           net.macports 1.0

github.setup        macports macports-infrastructure 8f3c1d3fccb92b14a1afc328e0f96913c709ebde
checksums           rmd160  317e4667a70dbfaf2c81ba9d76bcfebc9dd4ea9f \
                    sha256  29d43eb29b153cafe4080b6a6d1cfb16482b090aef59297aae4624a18f585f9f \
                    size    42090

name                net.macports.mprsyncup
version             24
revision            0

github.tarball_from archive
dist_subdir         ${github.project}

set python_branch   3.12
set python_version  [string map {. {}} ${python_branch}]

depends_run         port:coreutils \
                    port:git \
                    port:moreutils \
                    port:python${python_version} \
                    port:rsync

worksrcdir          ${worksrcdir}/jobs

extract.post_args-append \
                    ${worksrcdir}

patchfiles          delete_old_archives.py.patch \
                    mprsyncup.patch

destroot.keepdirs   ${destroot}${prefix}/var/log/${name} ${destroot}/Volumes/RAID${prefix}/var/rsync/macports
destroot {
    xinstall -d -o buildbot -g buildbot ${destroot}${prefix}/var/log/${name} ${destroot}/Volumes/RAID${prefix}/var/rsync/macports
    xinstall -W ${worksrcpath} current_versions.tcl delete_old_archives.py mprsyncup ${destroot}${prefix}/bin
    xinstall -W ${filespath} current_versions_for_each_portindex.sh mprsyncup-ts ${destroot}${prefix}/bin
    xinstall -m 0644 ${filespath}/${name}.plist.in ${destroot}/Library/${startupitem.location}/${name}.plist
    reinplace -W ${destroot}${prefix}/bin "s|@PREFIX@|${prefix}|g" current_versions_for_each_portindex.sh mprsyncup mprsyncup-ts ${destroot}/Library/${startupitem.location}/${name}.plist
    reinplace -W ${destroot}${prefix}/bin "1s|^#!/usr/bin/env |#!${prefix}/bin/|" current_versions.tcl
    reinplace -W ${destroot}${prefix}/bin "1s|^#!/usr/bin/env python$|#!${prefix}/bin/python${python_branch}|" delete_old_archives.py
}
